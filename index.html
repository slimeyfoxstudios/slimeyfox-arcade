<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Slimey Blaster</title>
<style>
body {margin:0; background:black; font-family:Arial;color:white; display:flex;flex-direction:row;justify-content:center;align-items:flex-start;height:100vh;}
#leaderboard {width:220px;background:#111;padding:10px;border-radius:8px;margin-right:10px;}
#leaderboard h3 {margin:0 0 5px 0;font-size:18px;color:#0ff;}
#leaderboard ol {padding-left:20px;text-align:left;}
#howToPlay {margin-top:10px;width:100%;padding:8px;font-size:16px;color:#0ff;background:#111;border:2px solid #0ff;border-radius:5px;cursor:pointer;}
#gameContainer {position: relative;}
canvas {display:block;background:#000;border:2px solid #333;}
#hud {position:absolute;top:10px;right:-180px;width:160px;text-align:left;font-size:18px;color:#0f0;}
#healthContainer {position:relative;width:30px;height:200px;background:#333;border:2px solid #0f0;margin-top:20px;}
#healthBar {position:absolute;bottom:0;width:100%;height:100%;background:green;}
#overlay {position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);color:#0ff;display:flex;flex-direction:column;justify-content:center;align-items:center;font-family:Arial;font-size:32px;z-index:10;transition:opacity 0.4s;}
#overlay.hidden {opacity:0;pointer-events:none;}
#overlay button {margin-top:20px;padding:15px 30px;font-size:24px;color:#0ff;background:#111;border:2px solid #0ff;border-radius:8px;cursor:pointer;}
</style>
</head>
<body>
<div id="leaderboard">
<h3>Top 10 High Scores</h3>
<ol id="scoresList"></ol>
<button id="howToPlay">How to Play</button>
</div>
<div id="gameContainer">
<canvas id="game" width="800" height="600"></canvas>
<div id="hud">
<div id="score">Score: 0</div>
<div id="healthContainer"><div id="healthBar"></div></div>
</div>
<div id="overlay">
<div id="overlayText">SLIMEY BLASTER</div>
<button id="startButton">START GAME</button>
</div>
</div>

<script>
// ────────────────────────────────────────────────
// SETUP
// ────────────────────────────────────────────────
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const hudScore=document.getElementById("score");
const healthBar=document.getElementById("healthBar");
const overlay=document.getElementById("overlay");
const overlayText=document.getElementById("overlayText");
const startButton=document.getElementById("startButton");

let ship={x:canvas.width/2,y:canvas.height/2,angle:0,size:20,dx:0,dy:0};
let bullets=[],enemies=[],particles=[];
let score=0,health=100,maxHealth=100;
let startTime=0,gameState="menu",difficulty=0.25,lastSpawnTime=0;
const minSpawnDelay=2200;

// Invincibility
let invincible=false,invincibleTimer=0;
const INVINCIBLE_DURATION=45; // ~0.75 seconds

// Audio
const AudioCtx=new (window.AudioContext||window.webkitAudioContext)();
function resumeAudio(){if(AudioCtx.state==='suspended')AudioCtx.resume();}
document.addEventListener('click',resumeAudio,{once:false});
document.addEventListener('touchstart',resumeAudio,{once:false});

// Sounds
function laserSound(){const o=AudioCtx.createOscillator();const g=AudioCtx.createGain();o.type="square";o.frequency.setValueAtTime(800,AudioCtx.currentTime);g.gain.value=0.15;o.connect(g);g.connect(AudioCtx.destination);o.start();o.stop(AudioCtx.currentTime+0.05);}
function explosionSound(){const o=AudioCtx.createOscillator();const g=AudioCtx.createGain();o.type="sawtooth";o.frequency.setValueAtTime(120,AudioCtx.currentTime);g.gain.setValueAtTime(0.2,AudioCtx.currentTime);o.connect(g);g.connect(AudioCtx.destination);o.start();o.stop(AudioCtx.currentTime+0.15);}
function deathSound(){const o=AudioCtx.createOscillator();const g=AudioCtx.createGain();o.type="triangle";o.frequency.setValueAtTime(60,AudioCtx.currentTime);g.gain.setValueAtTime(0.3,AudioCtx.currentTime);o.connect(g);g.connect(AudioCtx.destination);o.start();o.stop(AudioCtx.currentTime+0.5);}

// Stars
const stars=[];
for(let i=0;i<150;i++){stars.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,size:Math.random()*2+1,speed:Math.random()*0.3+0.1});}

// Controls
const keys={};
document.addEventListener("keydown",e=>keys[e.key]=true);
document.addEventListener("keyup",e=>keys[e.key]=false);

// Shoot
function shoot(){bullets.push({x:ship.x+Math.cos(ship.angle)*ship.size/2,y:ship.y+Math.sin(ship.angle)*ship.size/2,dx:Math.cos(ship.angle)*8,dy:Math.sin(ship.angle)*8,size:4});laserSound();}

// Spawn
function getEdgeSpawnPosition(){
  const margin=90; const safeZone=160; let x,y; const side=Math.floor(Math.random()*4);
  if(side===0){x=Math.random()*canvas.width;y=margin+Math.random()*60;}
  else if(side===1){x=canvas.width-margin-Math.random()*60;y=Math.random()*canvas.height;}
  else if(side===2){x=Math.random()*canvas.width;y=canvas.height-margin-Math.random()*60;}
  else{x=margin+Math.random()*60;y=Math.random()*canvas.height;}
  const dist=Math.hypot(x-ship.x,y-ship.y);
  if(dist<safeZone){const angle=Math.atan2(y-ship.y,x-ship.x);x=ship.x+Math.cos(angle)*safeZone;y=ship.y+Math.sin(angle)*safeZone;x=Math.max(margin,Math.min(canvas.width-margin,x));y=Math.max(margin,Math.min(canvas.height-margin,y));}
  return {x,y};
}

// Enemy
function createEnemy(type,forcedSize=null){
  const pos=getEdgeSpawnPosition(); const x=pos.x,y=pos.y;
  const elapsed=(Date.now()-startTime)/1000; const speedMultiplier=elapsed<120?0.5:0.8+difficulty*2.2; const baseSpeed=0.9*speedMultiplier;
  let size=forcedSize!==null?forcedSize:(type==="boulder"?40:type==="alien"?25:10);
  let enemy={x,y,size,type,health:type==="alien"?2:1};
  if(type==="health"){enemy.dx=0;enemy.dy=0;}
  else{const speedFactor=type==="boulder"?0.6:type==="alien"?0.9:1.3;enemy.dx=(Math.random()*2-1)*baseSpeed*speedFactor;enemy.dy=(Math.random()*2-1)*baseSpeed*speedFactor;}
  enemies.push(enemy); lastSpawnTime=Date.now();
}

function initEnemies(){enemies=[];for(let i=0;i<3;i++)createEnemy("boulder");if(Math.random()<0.5)createEnemy("health");}

// Particles
function createParticles(x,y,color,count=10){for(let i=0;i<count;i++){particles.push({x,y,dx:Math.random()*4-2,dy:Math.random()*4-2,size:Math.random()*3+1,life:30,color});}}

// Collision
function checkCollision(ax,ay,ar,bx,by,br){return Math.hypot(ax-bx,ay-by)<ar+br;}
function takeDamage(amount){health-=amount;if(health<0)health=0;updateHealthBar();if(health<=0){deathSound();gameOverSequence();}}
function updateHealthBar(){const percent=Math.max(0,health)/maxHealth*100;healthBar.style.height=percent+"%";healthBar.style.background=percent>50?"green":percent>25?"yellow":"red";}

// Start / Game Over
startButton.addEventListener("click",()=>{
  resumeAudio();
  if(gameState==="menu"||gameState==="gameover"){gameState="playing";overlay.classList.add("hidden");resetGame();requestAnimationFrame(loop);}
});

function gameOverSequence(){gameState="gameover";overlayText.textContent=`GAME OVER\nScore: ${score}`;startButton.textContent="PLAY AGAIN";overlay.classList.remove("hidden");}

// Reset
function resetGame(){ship={x:canvas.width/2,y:canvas.height/2,angle:0,size:20,dx:0,dy:0};bullets=[];enemies=[];particles=[];score=0;health=maxHealth;startTime=Date.now();difficulty=0.25;lastSpawnTime=0;invincible=false;invincibleTimer=0;initEnemies();updateHealthBar();hudScore.textContent="Score: 0";}

// UPDATE
function update(){
  if(gameState!=="playing")return;
  const now=Date.now(); const elapsed=(now-startTime)/1000;

  // Difficulty
  difficulty=elapsed<120?0.25+(elapsed/120)*0.4:0.65+Math.pow((elapsed-120)/90,1.4)*3.0;
  difficulty=Math.min(difficulty,4.5);

  // Ship movement
  if(keys["ArrowLeft"])ship.angle-=0.08;
  if(keys["ArrowRight"])ship.angle+=0.08;
  if(keys["ArrowUp"]){ship.dx+=Math.cos(ship.angle)*0.16;ship.dy+=Math.sin(ship.angle)*0.16;}
  ship.x+=ship.dx;ship.y+=ship.dy;
  if(ship.x<0)ship.x=canvas.width;if(ship.x>canvas.width)ship.x=0;if(ship.y<0)ship.y=canvas.height;if(ship.y>canvas.height)ship.y=0;

  // Shooting
  if(keys[" "]&&!keys._shooted){shoot();keys._shooted=true;}
  if(!keys[" "])keys._shooted=false;

  // Bullets
  for(let i=bullets.length-1;i>=0;i--){
    const b=bullets[i];b.x+=b.dx;b.y+=b.dy;
    if(b.x<0||b.x>canvas.width||b.y<0||b.y>canvas.height){bullets.splice(i,1);continue;}
    for(let j=enemies.length-1;j>=0;j--){
      const e=enemies[j];
      if(checkCollision(b.x,b.y,b.size,e.x,e.y,e.size)){
        createParticles(e.x,e.y,"#f0f");bullets.splice(i,1);e.health--;
        if(e.health<=0){explosionSound();if(e.type==="boulder"){score+=10;if(e.size>22){setTimeout(()=>createEnemy("boulder",26+Math.random()*4),500);setTimeout(()=>createEnemy("boulder",26+Math.random()*4),900);}else if(e.size>15){setTimeout(()=>createEnemy("boulder",16+Math.random()*4),500);setTimeout(()=>createEnemy("boulder",16+Math.random()*4),900);}}else if(e.type==="alien"){score+=20;}else if(e.type==="health"){score+=10;health=Math.min(maxHealth,health+40);}else{score+=10;}enemies.splice(j,1);}
        break;
      }
    }
  }

  // Enemy update & collisions
  for (let i = enemies.length - 1; i >= 0; i--) {
    const e = enemies[i];
    if (e.type !== "health") {
      e.x += e.dx * (1 + difficulty * 0.08);
      e.y += e.dy * (1 + difficulty * 0.08);
    }
    if (e.x < 0) e.x = canvas.width;
    if (e.x > canvas.width) e.x = 0;
    if (e.y < 0) e.y = canvas.height;
    if (e.y > canvas.height) e.y = 0;

    // Collision with ship
    if (checkCollision(ship.x, ship.y, ship.size / 2, e.x, e.y, e.size)) {
      if (e.type === "health") {
        score += 10;                     
        health = Math.min(maxHealth, health + 40); 
        createParticles(ship.x, ship.y, "#0f0", 15);
        enemies.splice(i, 1);
      } else if (!invincible) {
        takeDamage(20);
        createParticles(ship.x, ship.y, "#0f0", 15);

        // Gentle bounce
        const dx = ship.x - e.x;
        const dy = ship.y - e.y;
        const dist = Math.hypot(dx, dy) || 1;
        const bounceForce = 2.5; // gentle bounce
        ship.dx = (dx / dist) * bounceForce;
        ship.dy = (dy / dist) * bounceForce;

        invincible = true;
        invincibleTimer = INVINCIBLE_DURATION;
      }
    }
  }

  // Invincibility timer
  if (invincible){invincibleTimer--; if(invincibleTimer<=0)invincible=false;}

  // Particles
  for(let i=particles.length-1;i>=0;i--){const p=particles[i];p.x+=p.dx;p.y+=p.dy;p.life--;if(p.life<=0)particles.splice(i,1);}

  // Spawn new enemies
  const timeSinceLast=now-lastSpawnTime;
  let spawnChance=elapsed<120?0.001:0.003+difficulty*0.011;
  const maxEnemies=5+Math.floor(difficulty*2.5);
  if(enemies.length<maxEnemies&&timeSinceLast>minSpawnDelay&&Math.random()<spawnChance){
    const types=["boulder"];if(difficulty>0.9)types.push("alien");if(difficulty>1.8)types.push("swarm");
    createEnemy(types[Math.floor(Math.random()*types.length)]);
  }

  // Rare health orb
  if(Math.random()<0.0008+(1.4-difficulty)*0.0012)createEnemy("health");

  hudScore.textContent="Score: "+score;
}

// DRAWING
function drawStars(){ctx.fillStyle="white";stars.forEach(s=>{ctx.fillRect(s.x,s.y,s.size,s.size);s.y+=s.speed;if(s.y>canvas.height)s.y=0;});}
function drawShip(){ctx.save();ctx.translate(ship.x,ship.y);ctx.rotate(ship.angle);if(invincible&&Math.floor(invincibleTimer/5)%2===0)ctx.globalAlpha=0.4;ctx.shadowBlur=15;ctx.shadowColor="#0f0";ctx.fillStyle="#0f0";ctx.beginPath();ctx.moveTo(ship.size,0);ctx.lineTo(-ship.size/2,ship.size/2);ctx.lineTo(-ship.size/2,-ship.size/2);ctx.closePath();ctx.fill();ctx.shadowBlur=0;ctx.globalAlpha=1;ctx.restore();}
function drawEnemies(){enemies.forEach(e=>{ctx.save();ctx.translate(e.x,e.y);if(e.type==="boulder"||e.type==="swarm"){ctx.strokeStyle="#f0f";ctx.lineWidth=2;ctx.beginPath();for(let i=0;i<8;i++){const ang=(i/8)*Math.PI*2;const r=e.size*(0.7+Math.random()*0.3);const px=Math.cos(ang)*r;const py=Math.sin(ang)*r;if(i===0)ctx.moveTo(px,py);else ctx.lineTo(px,py);}ctx.closePath();ctx.stroke();}else if(e.type==="alien"){ctx.fillStyle="#f00";ctx.beginPath();ctx.arc(0,0,e.size,0,Math.PI*2);ctx.fill();}else if(e.type==="health"){ctx.fillStyle="#0f0";ctx.beginPath();ctx.arc(0,0,e.size,0,Math.PI*2);ctx.fill();}ctx.restore();});}
function drawBullets(){ctx.fillStyle="#0ff";bullets.forEach(b=>{ctx.beginPath();ctx.arc(b.x,b.y,b.size,0,Math.PI*2);ctx.fill();});}
function drawParticles(){particles.forEach(p=>{ctx.fillStyle=p.color;ctx.globalAlpha=p.life/30;ctx.beginPath();ctx.arc(p.x,p.y,p.size,0,Math.PI*2);ctx.fill();});ctx.globalAlpha=1;}
function drawHUD(){const elapsedSec=Math.floor((Date.now()-startTime)/1000);const min=Math.floor(elapsedSec/60).toString().padStart(2,'0');const sec=(elapsedSec%60).toString().padStart(2,'0');ctx.fillStyle="white";ctx.font="20px Arial";ctx.fillText(`Time: ${min}:${sec}`,10,30);}

// LOOP
function loop(){if(gameState!=="playing")return;ctx.clearRect(0,0,canvas.width,canvas.height);drawStars();update();drawShip();drawEnemies();drawBullets();drawParticles();drawHUD();requestAnimationFrame(loop);}
</script>
</body>
</html>
